<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Basic area-level model</title>

<script src="data:application/javascript;base64,Ly8gUGFuZG9jIDIuOSBhZGRzIGF0dHJpYnV0ZXMgb24gYm90aCBoZWFkZXIgYW5kIGRpdi4gV2UgcmVtb3ZlIHRoZSBmb3JtZXIgKHRvCi8vIGJlIGNvbXBhdGlibGUgd2l0aCB0aGUgYmVoYXZpb3Igb2YgUGFuZG9jIDwgMi44KS4KZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKGUpIHsKICB2YXIgaHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJkaXYuc2VjdGlvbltjbGFzcyo9J2xldmVsJ10gPiA6Zmlyc3QtY2hpbGQiKTsKICB2YXIgaSwgaCwgYTsKICBmb3IgKGkgPSAwOyBpIDwgaHMubGVuZ3RoOyBpKyspIHsKICAgIGggPSBoc1tpXTsKICAgIGlmICghL15oWzEtNl0kL2kudGVzdChoLnRhZ05hbWUpKSBjb250aW51ZTsgIC8vIGl0IHNob3VsZCBiZSBhIGhlYWRlciBoMS1oNgogICAgYSA9IGguYXR0cmlidXRlczsKICAgIHdoaWxlIChhLmxlbmd0aCA+IDApIGgucmVtb3ZlQXR0cmlidXRlKGFbMF0ubmFtZSk7CiAgfQp9KTsK"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="data:text/css,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Basic area-level model</h1>



<p>The basic area-level model <span class="citation">(Fay and Herriot 1979; Rao and Molina 2015)</span> is given by <span class="math display">\[
y_i | \theta_i \stackrel{\mathrm{ind}}{\sim} {\cal N} (\theta_i, \psi_i) \,, \\
\theta_i = \beta&#39; x_i  + v_i \,,
\]</span> where <span class="math inline">\(i\)</span> runs from 1 to <span class="math inline">\(m\)</span>, the number of areas, <span class="math inline">\(\beta\)</span> is a vector of regression coefficients for given covariates <span class="math inline">\(x_i\)</span>, and <span class="math inline">\(v_i \stackrel{\mathrm{ind}}{\sim} {\cal N} (0, \sigma_v^2)\)</span> are independent random area effects. For each area an observation <span class="math inline">\(y_i\)</span> is available with given variance <span class="math inline">\(\psi_i\)</span>.</p>
<p>First we generate some data according to this model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> 75L  <span class="co"># number of areas</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">area=</span><span class="dv">1</span><span class="sc">:</span>m,      <span class="co"># area indicator</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x=</span><span class="fu">runif</span>(m)     <span class="co"># covariate</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m, <span class="at">sd=</span><span class="fl">0.5</span>)    <span class="co"># true area effects</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>df<span class="sc">$</span>x <span class="sc">+</span> v  <span class="co"># quantity of interest</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>psi <span class="ot">&lt;-</span> <span class="fu">runif</span>(m, <span class="fl">0.5</span>, <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, m, <span class="at">replace=</span><span class="cn">TRUE</span>)  <span class="co"># given variances</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(m, theta, <span class="fu">sqrt</span>(psi))</span></code></pre></div>
<p>A sampler function for a model with a regression component and a random intercept is created by</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mcmcsae)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> y <span class="sc">~</span> <span class="fu">reg</span>(<span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x, <span class="at">name=</span><span class="st">&quot;beta&quot;</span>) <span class="sc">+</span> <span class="fu">gen</span>(<span class="at">factor =</span> <span class="sc">~</span><span class="fu">iid</span>(area), <span class="at">name=</span><span class="st">&quot;v&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sampler <span class="ot">&lt;-</span> <span class="fu">create_sampler</span>(model, <span class="at">sigma.fixed=</span><span class="cn">TRUE</span>, <span class="at">Q0=</span><span class="dv">1</span><span class="sc">/</span>psi, <span class="at">linpred=</span><span class="st">&quot;fitted&quot;</span>, <span class="at">data=</span>df)</span></code></pre></div>
<p>The meaning of the arguments used here is as follows:</p>
<ul>
<li>the first argument is a formula specifying the response variable and the linear predictor part of the model</li>
<li><code>sigma.fixed=TRUE</code> signifies that the observation level variance parameter is fixed at 1. In this case it means that the variances are known and given by <code>psi</code>.</li>
<li>the function expects precisions rather than variances, and with <code>Q0=1/psi</code> the precisions are set to the vector <code>1/psi</code>.</li>
<li><code>linpred=&quot;fitted&quot;</code> indicates that we wish to obtain samples from the posterior distribution for the vector <span class="math inline">\(\theta\)</span> of small area means.</li>
<li><code>data</code> is the <code>data.frame</code> in which variables used in the model specification are looked up.</li>
</ul>
<p>An MCMC simulation using this sampler function is then carried out as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">MCMCsim</span>(sampler, <span class="at">store.all=</span><span class="cn">TRUE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>A summary of the results is obtained by</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>(summ <span class="ot">&lt;-</span> <span class="fu">summary</span>(sim))</span></code></pre></div>
<pre><code>## llh_ :
##       Mean   SD t-value  MCSE q0.05  q0.5 q0.95 n_eff R_hat
## llh_ -28.6 5.86   -4.88 0.123 -38.8 -28.4 -19.7  2285     1
## 
## linpred_ :
##    Mean    SD t-value    MCSE q0.05 q0.5 q0.95 n_eff R_hat
## 1  1.70 0.219    7.72 0.00401 1.332 1.69  2.05  3000     1
## 2  4.34 0.314   13.83 0.00646 3.820 4.35  4.86  2361     1
## 3  2.84 0.293    9.71 0.00549 2.366 2.84  3.33  2840     1
## 4  1.96 0.187   10.49 0.00364 1.649 1.96  2.26  2633     1
## 5  2.34 0.148   15.77 0.00271 2.092 2.34  2.58  3000     1
## 6  1.43 0.228    6.26 0.00436 1.049 1.43  1.79  2722     1
## 7  1.33 0.238    5.59 0.00454 0.943 1.33  1.73  2755     1
## 8  1.37 0.378    3.62 0.00689 0.744 1.37  1.98  3000     1
## 9  3.03 0.219   13.83 0.00399 2.660 3.02  3.39  3000     1
## 10 2.77 0.279    9.93 0.00532 2.310 2.78  3.22  2760     1
## ... 65 elements suppressed ...
## 
## beta :
##             Mean    SD t-value    MCSE q0.05 q0.5 q0.95 n_eff R_hat
## (Intercept) 1.06 0.145    7.29 0.00767 0.826 1.06  1.30   360  1.01
## x           2.96 0.249   11.88 0.01259 2.536 2.96  3.38   391  1.00
## 
## v_sigma :
##          Mean     SD t-value    MCSE q0.05  q0.5 q0.95 n_eff R_hat
## v_sigma 0.508 0.0616    8.24 0.00165 0.414 0.504 0.614  1403     1
## 
## v :
##       Mean    SD t-value    MCSE  q0.05    q0.5   q0.95 n_eff R_hat
## 1  -0.4489 0.227  -1.974 0.00572 -0.827 -0.4514 -0.0714  1581 1.001
## 2   0.4102 0.319   1.285 0.00743 -0.125  0.4160  0.9312  1847 1.001
## 3  -0.2350 0.296  -0.795 0.00589 -0.725 -0.2384  0.2594  2523 1.002
## 4  -0.0225 0.202  -0.111 0.00578 -0.361 -0.0179  0.3055  1223 1.003
## 5  -0.6184 0.165  -3.752 0.00458 -0.892 -0.6166 -0.3500  1295 1.002
## 6  -0.4630 0.239  -1.937 0.00602 -0.859 -0.4612 -0.0754  1579 1.001
## 7   0.0312 0.257   0.121 0.00765 -0.384  0.0283  0.4576  1132 1.001
## 8   0.0625 0.380   0.165 0.00780 -0.570  0.0580  0.6936  2367 0.999
## 9   0.4808 0.226   2.129 0.00541  0.107  0.4757  0.8543  1743 1.002
## 10 -0.8638 0.290  -2.978 0.00678 -1.343 -0.8563 -0.4074  1828 1.000
## ... 65 elements suppressed ...</code></pre>
<p>In this example we can compare the model parameter estimates to the ‘true’ parameter values that have been used to generate the data. In the next plots we compare the estimated and ‘true’ random effects, as well as the model estimates and ‘true’ estimands. In the latter plot, the original ‘direct’ estimates are added as red triangles.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(v, summ<span class="sc">$</span>v[, <span class="st">&quot;Mean&quot;</span>], <span class="at">xlab=</span><span class="st">&quot;true v&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;posterior mean&quot;</span>); <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(theta, summ<span class="sc">$</span>linpred_[, <span class="st">&quot;Mean&quot;</span>], <span class="at">xlab=</span><span class="st">&quot;true theta&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;estimated&quot;</span>); <span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(theta, df<span class="sc">$</span>y, <span class="at">col=</span><span class="dv">2</span>, <span class="at">pch=</span><span class="dv">2</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" /><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAZlBMVEUAAAAAADoAAGYAOjoAOpAAZrY6AAA6ADo6AGY6OpA6kNtmAABmADpmkJBmtrZmtv+QOgCQZgCQkGaQ2/+2ZgC225C2/7a2///bkDrb2//b/7bb///fU2v/tmb/25D//7b//9v////ewKk4AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAMOklEQVR4nO2djXrjqhGG2e0mp3VOe9Ku2+N2sR3u/yZrGECgvw+BEMSZbzfxEwkL9D4wDANIQrFWJVoXoHcxICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExICAGBMSAgBgQ0M6ARDPJQELi9K0A7Xu5zdkLqdTjv/mJTkxSJl+ytExVL7c5d2n+jQHN1JcvCUhoMJLYyPj4XNrki+6pxoCCyuMJzZubrwbI4HgYIG2sgyPLJfpigFy70o3Ma7VAzwNo3B8tJDKNi7pvX4lMnVrQ0wCSKYRc3065C/8dsfztLwfI9F9x8xJi7tvWR3wWQHNO32wi/Yvu3bjR0nb6k2+L4CdJOXd0e/1jz8utSPpfKIGkBqYZESCh5gAJ97sKoPvbMJT5/mfx5RI0dfriv6UzP74xCQtKzn+7LiB1FSf9cVgNkqNP95f/21gby0JYX0jK2GU8EtCjDv34NQdo+yA5SQiQjE2zKYkZykcd2IRQVRt0/vbzsBo0und3VHlGUoZmylhmKclCLwGq34tdxOk4Iz0nA4iMj/EMpUegA0GzKino9ju6vf6lJSBnWAgQ1Rt7TLquTLpiLLf5mt38x7toDUgbGimJQxxLDBKtGptncRQnsnzIOltAlK8cRvK+y18u0vMCmrUx5BWGdWkozBcDpOUHpaY/t+1IGidahmaHASkxdNrkHkoZFmI/G5QwiNhyubqa6b+F7rhstCwsxa69GI0jrg9HsEBHRRTtnUv/l2luxk7LpFJsB/Tx/mI+L3owka3dAc3XAXd0CPxEXX0VQPc3cm6uXTWxWSuiEUjquEyDcsZYmsPeGYIXTi6B0ce7Gamrc081aLYfkuTxCBtqdbXJmCFJ5mjHgoY2SFehS0MbNB0zzQEy43Vp7I2wNOhHUpBDzI69sgsaJDRdWVH9KQM0F0CeXlQYh9DEDYdRu4jN0J4F7cgPmovPT20QDebNWEyfEmZg74ZgNiSVQOgTApqPz0e9mLDDLUmBDXKkQ0Aq/tyjoHET+/HrfEr9Zlm+E63F54fBuenFpY380LkwHpTeyHKM9LefDx/o/lZEqBDQPCHb9kzHLu2YNByZLs+f7lDQqJvXTuKljR+01joGQKNRvHCR1e2E8hxFDaiRo7gCyBFwvTjFnd3ERSah/BrUxlFcMR+jqLyNtEoXbD0MkLVBl+Vw6q75pot8ZUOBujSyOi6quMH3ySro2FFMcKSvK6n2BySdn0zTy/FyVjw3vaRKftBZiNPtb7/8yLbwcikK1rTEZAI2h/Ri99+pVqwZaW2fzqb2LAVFdgcUNSJdhUYHVKrrnFvQCaCVbt7Um9tvOt0IY6WpZ3ttM/2ljA0yUWcVVCDhLdTGq25MeB5ucdlRJCfy47/quBpkPEJDRlFrk7RY3M0c5troghq0Jl+7Fv3tnQGRuaF4qomT0SBDDM6jGH5vUiUjbaNF10VfoAIg6uBdxRn1YEcCcjMbHYVc5QDILRqjsDzVKJdhUhA6t6BDwkcXdXlZW9qya75J8oN2u0JBqHgm3uQocvhkjcVO6qoHq81i0pM+UNr1LOPdTkMAaPZr+xY0Gqze/vqn+clXAaBJ8JA8Haopwo/nlUgMy+PctiXUg1Xdk7UCNA0/SzlyC61HSIumCpVhg3Qffj41amJyCihsVMLN7rjYYUER1Tij5ITnF92TFXViuYCkH3KFhwwXJfzYPYRWUshNBe0jaO/s7kIFUm5V4n76XIBo7BB1R1Ko3gA1dBRnYoKSRqFCWoscTF7sopxerHBSdVu+oVzMMBiXRxZauFWJ5eXbXtDIDzow31DSxwzVMIVjHGTquIyZVvtWoTw/6MB8AwUxQ7MwwfwhnIs8DpDtpAwbRJGwo/IdNHJ3lAuPmctZ52fDnHKicgC9NjHSgQvkAI0GVyWTF4vKaWIvR+brNbhAC3Nc2RMXq/osRloGLhAtjJrsVM6euFjVJzHStPDbITB0xnMU+5sfo09ipIdwmAekZgHtMYCPlNPEjl9I7lau2Fn2OVNcwT5vK+jGoP0DoDFVS7Nnmy4n3UDC+4ELrs40VlSsOoD0pMb9Tfd2+wCa19JV+wdEdtwM2ooBud0Dws0KirkuPrpqS0D3t1OCDXKegJ7/KJx6polA27fThIWwE2BLyfcNzFSsQUrHHgtr0GiQFXTuC6Z491n/jF4sYXWHw7Icmd0ASNlwqrC7T21/vrvPvFaCLQkTVnfoXowa2cf7PoDsgigXfnaW6ABtBZS0umPHfK1Rses0RDTBU5J/svJr0FH5upWYfu38evr2Y7Gj8pW0Gdc6hW6bKQK0c8g+M2h/0p5yWWR6OV/r5UhaLC+ki3NIaVeOrRLoAdDDu7m9vujpwxr5SvfPbM+hbit+aN0agayl0HkFXUyovUC9MKrSSnuLR6oQ0MBGrteRXgCdH3Dq7NWwd+gC81L6xeEpVahCzCynib3oxyfRWHTvfF3YlAyO9Z0DJMNjtZa/3hzQwz3+9rM0Mr0IyJll6Ze1CB+ud59LBGoEFfvq5qm7EtZhDluVJeNnxha+Hn/WK2hJwpLL+e0547gPkQFWqEpQMQdQtS2Zc1ExMtT+lvePZwBlAKq5JXP+2WIq2ONeZRfDivKmfepsyaSQGAV9YlJCHTQ0nSnU5oTVtmQK8g/tPvexi9iKUH4N2ntLpvCDLloQRc+TcA+wO7ZdRcXanLDSlkwzpTNaUGeXrS5FoI9QZi8mUrZkbsuXRvBi3ky3skA9+UFS+BBQjGnfjLeqG0By3g1qzactoNCnsXMVygfIai342aiWgEKvOK4yAZovDCiYJx6eD6Xsnjjl0TyjDUp7ZLsdmCobHnPPq3O/Ky2I2qo6NWh5vjCYm6dAvLCGx5mjAVAfZrpSE4PxNF9x6NPvfeuk3gyqZYOW9zsHl5Nua7uYBAufHlDK5Vx/FQSa+/F/nFoDovXhmc/VOEINAVlzLLprVZFaA+po1DWvdoCkvWqXWAY1BNR1xfFqOxY7fI5iu5qOxYLRWLdqBkjEw9Vu1TYeVOPKO6ttRFGohvMVaWoccs16/uyhag2odzeopZEW7mHzfasRoOwMmiQ7+FJFGTCgHpMdfKmiDBhQj8kOvlRRBgyox2QHX6ooAwbUY7KDL/WcYkBADAiIAQExICAGBMSAgBgQEAMCYkBADAiIAQExIKDagFJesvDxLpKeynMRqZuRyja9RaoM6P6GNzB+vD9u+yLghn29WfSaROha+kbmQHUBXVOeW0lvy4F7Zc1246QHH5jt24klhKoK6CpOyVtg0+pGEqDLj39+EkBq/Zlxkc5JCVPe9n777efnsUHJgK4pVvqaYsv17uTnA3TFNtoo4d0N5Vu3I/UBKKn+UErUxsxTn58N0CX92YTwBXEXu7xlj+era/UAKG2vPqFJq5HPVYNur2n1R9914oPlnwuQbRS4Az8nt5xPBOjTiwEBMSAgBgTEgIAYEBADAmJAQAwIiAEBMSAgBgTEgIAYEBADAmJAQAwIiAEBMSAgBgTEgIAYEBADAmJAQAwIiAEBMSCgLgBdV2fcH2fdO4JTv7KjegA0vf3x2UmK9a/sKQYE1AGg26sQP/73+7/E9//o2zb3fvFr7+ns299faekLnTAHf21YD5OvDgDZOvK44bsDpFf7unVVdFYvxrc/+oRJqV/ombIuuEj9ADopD4je4WXXXvmzt9fhhDmo3y0M1yyWqh9AfwyAaCmrvffwrD/hbNC1ehvrE1C4UjUC5E44Q/X931+4Bs2c9Sf0AVPDvloTO0UNaHx2OGHeK6xtFHoLQbH6AGS7Jb3R4ONdUC+mzlRd/FnXvekT+qCuPPe39DXoeeoB0MOfeXg6uibod7/8w/lBbgGxO3sPTzwO/jI7EM+V+/kuAPUsBgTEgIAYEBADAmJAQAwIiAEBMSAgBgTEgIAYEBADAmJAQAwIiAEBMSAgBgTEgIAYEBADAmJAQAwIiAEB/R/haq0H+l4DgQAAAABJRU5ErkJggg==" /></p>
<p>We can compute model selection measures DIC and WAIC by</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_DIC</span>(sim)</span></code></pre></div>
<pre><code>##       DIC     p_DIC 
## 107.22061  49.99015</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_WAIC</span>(sim, <span class="at">show.progress=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>##     WAIC1   p_WAIC1     WAIC2   p_WAIC2 
##  78.04790  20.82357 100.73028  32.16476</code></pre>
<p>Posterior means of residuals can be extracted from the simulation output using method <code>residuals</code>. Here is a plot of (posterior means of) residuals against covariate <span class="math inline">\(x\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df<span class="sc">$</span>x, <span class="fu">residuals</span>(sim, <span class="at">mean.only=</span><span class="cn">TRUE</span>), <span class="at">xlab=</span><span class="st">&quot;x&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;residual&quot;</span>); <span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>A linear predictor in a linear model can be expressed as a weighted sum of the response variable. If we set <code>compute.weights=TRUE</code> then such weights are computed for all linear predictors specified in argument <code>linpred</code>. In this case it means that a set of weights is computed for each area.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sampler <span class="ot">&lt;-</span> <span class="fu">create_sampler</span>(model, <span class="at">sigma.fixed=</span><span class="cn">TRUE</span>, <span class="at">Q0=</span><span class="dv">1</span><span class="sc">/</span>psi,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">linpred=</span><span class="st">&quot;fitted&quot;</span>, <span class="at">data=</span>df, <span class="at">compute.weights=</span><span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">MCMCsim</span>(sampler, <span class="at">store.all=</span><span class="cn">TRUE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Now the <code>weights</code> method returns a matrix of weights, in this case a 75 <span class="math inline">\(\times\)</span> 75 matrix <span class="math inline">\(w_{ij}\)</span> holding the weight of direct estimate <span class="math inline">\(i\)</span> in linear predictor <span class="math inline">\(j\)</span>. To verify that the weights applied to the direct estimates yield the model-based estimates we plot them against each other. Also shown is a plot of the weight of the direct estimate for each area in the predictor for that same area, against the variance of the direct estimate.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(summ<span class="sc">$</span>linpred_[, <span class="st">&quot;Mean&quot;</span>], <span class="fu">crossprod</span>(<span class="fu">weights</span>(sim), df<span class="sc">$</span>y),</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;estimate&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;weighted average&quot;</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(psi, <span class="fu">diag</span>(<span class="fu">weights</span>(sim)), <span class="at">ylab=</span><span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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5fJBy+edl6ury/mMqshJVzV4OQmH+Qw3cVYU+8wlCRRz3MRZH5lRsqlG8ps4a8UjnawmvomzWvPpYywowVmN0eVUjCfCByW4idP8rNl8+ojJavxNnE3YC2ykDeOgSsf1T9oWUPOIFjR0sAR7z8Z86ucjsaBxthp9oK6ONWckcRd738fFQXfARksGSBlRpAXdjcIBXV4jExc82yleMM4hzpx0Pjr9IwDSJpQihwq2U7pgMkC9PnKZIhEPtlO0YEpA+XraAwCypxEI6PbDwxAffWG7TzvlC6btYrlEQKna+a6A7lYEBERAQAQEREBABAREQEAEBERAQAQEREBABAREQECFAPl9Woe+28Arw+0csj8VldFTBpDfQu7HcfhLn312DlQanPfFzl3U9aJFAHV+C7nm3LVHDqBOpPQ9c6NzU71K3lQJQF2zC0js87UMX0Dn579rB9QH3Wvle9jI897iy8/THfigAECdn5fuPL25Sr18KECd9+6uvhEUKjovtTJAnvZjynr0Mf2RlQ8E6Bxyg5rPZSPncTdUvqFeFSDfHGSDxrvbPowFXV597Uf9ld3Nsl6lxaoJ0NgffIbvNqTb3AOg+xUBAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBABAREQEAEBERAQAQEREBABAREQUK2AusPaxzF1me6HuKFKAa1/VlWaT7LyEwEB1QLoPObYq1uMmoP6+vzfgOHy+td++Ib6vWJisl70d9/cI3lVCSCV06vyp3TumP50GOODLq86+f7HL51f3r7Yz7w/TI9kVh2AzB3Es888mQDtevvloD/pVCE03x0fyfxqdQAyCauKwXioYwJ06GdfdH60+Y57JPOrVQLIJaPqAz+HBUCD1/nxz2hBXXT+qp8qAXSVl9g+nW4Ccr+ZLCi/6gB0PW4Pv7sJSDucbmZfJVQHIHMyZbAcbRedsqDdbQt63zc746DtI5nfrBJAOqgxBmLygFsbB33yQU8nxaS1cVD2QawaQNWKgIAICIiAgAgIiICACAiIgIAICIiAgAgIiICACAiIgIAICIiAgAgIiICACAiIgIAICIiAgAgIiICA/gcpO671qbXT8QAAAABJRU5ErkJggg==" /><img src="data:image/png;base64,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" /></p>
<div id="references" class="section level2 unnumbered">
<h2 class="unnumbered">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Fay1979" class="csl-entry">
Fay, R. E., and R. A. Herriot. 1979. <span>“Estimates of Income for Small Places: An Application of James-Stein Procedures to Census Data.”</span> <em>Journal of the American Statistical Association</em> 74 (366): 269–77.
</div>
<div id="ref-rao2015small" class="csl-entry">
Rao, J. N. K., and I. Molina. 2015. <em>Small Area Estimation</em>. John Wiley &amp; Sons.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
